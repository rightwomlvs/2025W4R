<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Hero's Mailbox - Detective Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'line-header': '#2c3e50', // æ·±è‰²æ¨™é¡Œ
                        'line-bg': '#9bbad8',     // èŠå¤©å®¤èƒŒæ™¯è—
                        'line-green': '#06c755',  // LINE å®˜æ–¹ç¶ 
                        'line-user': '#9de694',   // ç”¨æˆ¶å°è©±æ¡†ç¶ 
                    }
                }
            }
        }
    </script>
    <style>
        /* Mobile Optimization */
        body { overscroll-behavior-y: none; }
        
        /* Custom Scrollbar */
        .chat-scroll::-webkit-scrollbar { width: 4px; }
        .chat-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }

        /* Animations */
        @keyframes message-pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .msg-animate { animation: message-pop 0.3s ease-out forwards; }

        /* Typing Indicator Animation */
        .typing-dot { animation: typingBounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Chat Bubble Tails */
        .bubble-left::before {
            content: "";
            position: absolute;
            top: 12px;
            left: -6px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 8px solid white;
        }
        .bubble-right::before {
            content: "";
            position: absolute;
            top: 12px;
            right: -6px;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 8px solid #06c755;
        }
    </style>
</head>
<body class="bg-gray-800 h-[100dvh] w-full flex justify-center items-center font-sans overflow-hidden">

    <!-- Game Container (Phone Frame) -->
    <div class="relative w-full h-full md:max-w-[400px] md:h-[85vh] md:rounded-3xl md:shadow-2xl bg-line-bg flex flex-col overflow-hidden md:border md:border-gray-600">
        
        <!-- Header -->
        <header class="bg-line-header text-white p-4 flex items-center justify-between shadow-md z-20 shrink-0 h-16">
            <button class="text-xl opacity-80 hover:opacity-100 w-8" onclick="location.reload()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="text-center">
                <h1 class="font-bold text-lg tracking-wide">HR Detective Unit ğŸ•µï¸</h1>
                <p class="text-[10px] text-gray-300 opacity-80">Case #2025 Active</p>
            </div>
            <button class="text-xl opacity-80 hover:opacity-100 w-8">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- Chat Area -->
        <main id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4 chat-scroll relative bg-line-bg">
            <!-- Dynamic content will be injected here -->
        </main>

        <!-- Typing Indicator (Overlay) -->
        <div id="typing-indicator" class="absolute bottom-[80px] left-4 z-30 hidden transition-opacity duration-300">
            <div class="bg-white p-3 rounded-2xl shadow-md flex items-center gap-1 w-16 h-10 bubble-left relative">
                <div class="w-1.5 h-1.5 bg-gray-500 rounded-full typing-dot"></div>
                <div class="w-1.5 h-1.5 bg-gray-500 rounded-full typing-dot"></div>
                <div class="w-1.5 h-1.5 bg-gray-500 rounded-full typing-dot"></div>
            </div>
            <span class="text-[10px] text-gray-600 ml-1 mt-1 block">Commander typing...</span>
        </div>

        <!-- Input Area -->
        <footer class="bg-white p-2 md:p-3 flex items-center gap-2 border-t border-gray-200 z-40 shrink-0 safe-pb">
            <button class="text-gray-400 p-2 hover:bg-gray-100 rounded-full transition">
                <i class="fas fa-plus"></i>
            </button>
            <button class="text-gray-400 p-2 hover:bg-gray-100 rounded-full transition">
                <i class="fas fa-camera"></i>
            </button>
            <button class="text-gray-400 p-2 hover:bg-gray-100 rounded-full transition">
                <i class="fas fa-image"></i>
            </button>
            <div class="flex-1 relative">
                <input type="text" id="user-input" class="w-full bg-gray-100 text-gray-800 text-sm rounded-full py-2.5 px-4 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all placeholder-gray-400" placeholder="Type a message..." autocomplete="off">
            </div>
            <button id="send-btn" class="text-white bg-line-green hover:bg-green-600 w-10 h-10 rounded-full flex items-center justify-center shadow-sm transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-paper-plane text-sm"></i>
            </button>
        </footer>
    </div>

    <script>
        // --- 1. Game Content & Configuration ---
        const gameData = {
            intro: {
                part1: "Agent, welcome back.<br>æ¢å“¡ï¼Œæ­¡è¿æ­¸éšŠã€‚",
                image: "https://lh7-rt.googleusercontent.com/docsz/AD_4nXc2JxSrSNGV08gDNV0wjf74pxBNgNmLHHAx3wZ-QiAucwpD_Mvk_bJLG2qkZyysCLINcFkcBAnJJYHH7A58e8fV-m2nk9TivUt6DoQLpJ8QLRmIQ65OCAp8833VI_KiVg?key=fmW2EZQh-sSdi6uYu8ZY-w",
                part2: "We have 5 classified files that need your analysis.<br>æˆ‘å€‘æœ‰ 5 ä»½æ©Ÿå¯†æª”æ¡ˆéœ€è¦ä½ çš„åˆ†æã€‚<br><br><b>Please consult your '2025 Write for Rights' brochure. Vital clues are hidden inside.</b><br><b>è«‹åƒé–±ä½ æ‰‹ä¸Šçš„ã€Š2025 å¯«ä¿¡é¦¬æ‹‰æ¾å°å ±ã€‹ï¼Œé—œéµç·šç´¢å°±è—åœ¨å…¶ä¸­ã€‚</b><br><br>Type <b>'Start'</b> to open Case File #1."
            },
            level1: {
                text: "ğŸ“‚ **File #1: The Missing Data**<br><br>The 2024 report is corrupted.<br>2024å¹´çš„å ±å‘Šæ•¸æ“šææ¯€äº†ã€‚<br><br>Examine the image below. What is the participation number for 2024?<br>è§€å¯Ÿä¸‹æ–¹åœ–è¡¨ç´°ç¯€ï¼Œ2024å¹´çš„åƒèˆ‡äººæ•¸æ˜¯å¤šå°‘ï¼Ÿ",
                image: "https://lh7-rt.googleusercontent.com/docsz/AD_4nXd8MUnQdhMn7ISaQkcZfMw6xxwv0cn9WrlfVcPIuf2hC-W41VoQic3F-u19zLNNSKxt2wqnS8Dm5Gr3sMExvOJxzkMcQqAytuwbfbZoHRmR80_itb7V_SARmsQAC3qTyjc?key=fmW2EZQh-sSdi6uYu8ZY-w"
            },
            level2: {
                text: "ğŸ“‚ **File #2: The Crime Scene**<br><br>Unecebo (3 years old) died here.<br>Unecebo åœ¨æ­¤å–ªç”Ÿã€‚<br><br><b>Consult the 'South Africa (å—é)' case in your brochure.</b><br><b>æŸ¥é–±å°å ±ä¸­é—œæ–¼ã€Œå—éã€çš„æª”æ¡ˆã€‚</b><br><br>Look at the sketch. Which item is the 'Death Trap'?<br>è§€å¯Ÿç¾å ´ç´ æã€‚å“ªä¸€å€‹ç‰©å“æ˜¯ã€Œæ­»äº¡é™·é˜±ã€ï¼Ÿ<br>(Type the item name)",
                video: "zRkgHJRjtw0", // Unecebo video
                image: "https://lh7-rt.googleusercontent.com/docsz/AD_4nXeaugSKxv3iw40wsYCyqJXssBLMUQxMDK3MsLpDZdSV4GLxJ17TXv_JDHOWpeZCKzqSpuTgAdjwTdEBkr9KNEwA3_syC0OTQIUY1wiCwHjbfh9ytQ1eVHx1BbeVsvmf2bY?key=fmW2EZQh-sSdi6uYu8ZY-w"
            },
            level3: {
                text: "ğŸ“‚ **File #3: The Truth Test**<br><br>We have 3 witness statements about Human Rights.<br>æˆ‘å€‘æœ‰ä¸‰ä»½é—œæ–¼äººæ¬Šçš„è­‰è©ã€‚<br><br>Only one is TRUE. Which one?<br>åªæœ‰ä¸€ä»½æ˜¯çœŸçš„ï¼Œæ˜¯å“ªä¸€ä»½ï¼Ÿ<br>(Type A, B, or C)",
                image: "https://lh7-rt.googleusercontent.com/docsz/AD_4nXdMqrCnJaEMiH8l6N3bjy-7wWK6FOCv4GkSojsfaaBbdsZTQF1Fq3IL4TGg-2-RoRwuSI01hz3VinzGjhkWH17Erd9xb7qAbEgo2H86gb0QllSsQlH77NBRPCED86w9y2g?key=fmW2EZQh-sSdi6uYu8ZY-w",
                successImage: "https://lh7-rt.googleusercontent.com/docsz/AD_4nXcCbBv74SG5vd5T6FZQH1u4V-heaVtALN4rESK49yhjvxJ9mKdWhgqFHekH-zLI33CbRo9l8GRXLbidCG2vWGP4Qlf_FpGqgS6gLi3AL3FLufINk8tA13zDQL2kuWSrKGA?key=fmW2EZQh-sSdi6uYu8ZY-w"
            },
            level4: {
                text: "ğŸ“‚ **File #4: The Profile**<br><br>This hero was murdered in Honduras.<br>é€™ä½è‹±é›„åœ¨å®éƒ½æ‹‰æ–¯é‡å®³ã€‚<br><br><b>Find the 'Honduras (å®éƒ½æ‹‰æ–¯)' case in your brochure.</b><br><b>åœ¨å°å ±ä¸­æ‰¾å‡ºã€Œå®éƒ½æ‹‰æ–¯ã€çš„æ¡ˆä»¶ã€‚</b><br><br>Examine the evidence board. Who is he?<br>æª¢æŸ¥è­‰ç‰©æ¿ã€‚ä»–æ˜¯èª°ï¼Ÿ<br>(Type his name)",
                image: "https://lh7-rt.googleusercontent.com/docsz/AD_4nXednPvFlZ9cMtiryjo3MOJPCi-2wHDMx7MSL3ojAmvAsVvoBZB9FCX_KVfLF4oLFKkw5GCqMv4TXouLaokkR7GTz0Q_ATsP-0I-mIl3xI4kjR8fnNXOnCPrxI6TgPR6AA?key=fmW2EZQh-sSdi6uYu8ZY-w",
                successVideo: "q9fjmZI_Opk" // Juan Lopez video
            },
            level5: {
                text: "ğŸ“‚ **File #5: The Silenced Lawyer**<br><br>Final Task. Sonia Dahmani was arrested at the Tunisian Bar Association.<br>æœ€çµ‚ä»»å‹™ã€‚ç´¢å¦®äºÂ·é”èµ«ç‘ªå¦®åœ¨çªå°¼æ–¯å¾‹å¸«å”æœƒé­é€®æ•ã€‚<br><br><b>Read the 'Tunisia (çªå°¼è¥¿äº)' section in your brochure.</b><br><b>è©³è®€å°å ±ä¸­ã€Œçªå°¼è¥¿äºã€çš„æ®µè½ã€‚</b><br><br>According to the charge sheet, what specific crime was she convicted for?<br>æ ¹æ“šèµ·è¨´æ›¸ï¼Œç•¶å±€æœ€åˆåˆ¤è™•å¥¹æœ‰ç½ªçš„å…·é«”ç½ªåæ˜¯ä»€éº¼ï¼Ÿ",
                video: "C6pwtzTfw18" // Sonia Case Video (Updated)
            },
            end: {
                text: "ğŸ‰ **CASE CLOSED!**\n\nExcellent work, Detective.\nåšå¾—å¥½ï¼Œæ¢å“¡ã€‚\n\nSonia was jailed for **'Spreading False News'**.\nSonia å› ã€Œæ•£æ’­å‡æ–°èã€è€Œå…¥ç„ã€‚\nYour report is complete.",
                badge: "https://placehold.co/300x300/27ae60/FFF?text=BADGE+EARNED",
                link: "https://www.amnesty.tw/",
                finalVideo: "Ai1Lxcke-1s" // Final Shorts Video
            }
        };

        const gameState = {
            step: 0, 
            isProcessing: false
        };

        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingInd = document.getElementById('typing-indicator');

        // --- 2. UI Functions ---

        function scrollToBottom() {
            setTimeout(() => { 
                chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' }); 
            }, 100);
        }

        function setTyping(active) {
            active ? typingInd.classList.remove('hidden') : typingInd.classList.add('hidden');
            if(active) scrollToBottom();
        }

        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
        }

        async function botReply(content, type = 'text') {
            gameState.isProcessing = true;
            sendBtn.disabled = true; // Prevent spamming
            setTyping(true);

            // Simulation delay based on content length
            const delay = type === 'image' ? 1200 : 800; 

            return new Promise(resolve => {
                setTimeout(() => {
                    setTyping(false);
                    
                    const msgContainer = document.createElement('div');
                    msgContainer.className = 'flex items-start gap-2 msg-animate mb-4 w-full';
                    
                    let innerContent = '';
                    
                    if (type === 'image') {
                        innerContent = `
                            <div class="rounded-xl overflow-hidden border border-gray-200 shadow-sm max-w-[260px] bubble-left relative bg-white">
                                <img src="${content}" class="w-full h-auto object-cover" onload="scrollToBottom()" onerror="this.src='https://placehold.co/400x300?text=Image+Error'">
                            </div>`;
                    } else if (type === 'video') {
                        // Added autoplay=1 to ensure videos play automatically when inserted
                        innerContent = `
                            <div class="rounded-xl overflow-hidden border border-gray-200 shadow-sm w-full max-w-[280px] bubble-left relative bg-white">
                                <div class="aspect-video w-full">
                                    <iframe class="w-full h-full" src="https://www.youtube.com/embed/${content}?autoplay=1" title="YouTube video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                </div>
                            </div>`;
                    } else if (type === 'button') {
                        innerContent = `
                            <div class="bg-white p-3 rounded-xl shadow-sm text-gray-800 text-sm max-w-[85%] bubble-left relative">
                                <p class="mb-3">${content.text}</p>
                                <a href="${content.link}" target="_blank" class="block w-full bg-line-green text-white text-center py-2.5 rounded-lg font-bold hover:bg-green-600 transition shadow-sm">${content.btnText}</a>
                                <div class="text-[10px] text-gray-400 text-right mt-1">${getCurrentTime()}</div>
                            </div>`;
                    } else {
                        // Text processing
                        innerContent = `
                            <div class="bg-white p-3 rounded-xl shadow-sm text-gray-800 text-sm leading-relaxed max-w-[85%] bubble-left relative">
                                ${content}
                                <div class="text-[10px] text-gray-400 text-right mt-1">${getCurrentTime()}</div>
                            </div>`;
                    }

                    msgContainer.innerHTML = `
                        <div class="w-10 h-10 rounded-full bg-line-header border border-white flex items-center justify-center text-white shrink-0 shadow-sm z-10">
                            <i class="fas fa-user-secret"></i>
                        </div>
                        <div class="flex flex-col gap-1 w-full">
                            <span class="text-[10px] text-gray-600 ml-1">Commander</span>
                            ${innerContent}
                        </div>
                    `;

                    chatBox.appendChild(msgContainer);
                    scrollToBottom();
                    gameState.isProcessing = false;
                    sendBtn.disabled = false;
                    resolve();
                }, delay);
            });
        }

        function userReply(text) {
            const msgContainer = document.createElement('div');
            msgContainer.className = 'flex items-end justify-end gap-2 msg-animate mb-4';
            msgContainer.innerHTML = `
                <div class="flex flex-col items-end max-w-[80%]">
                    <div class="bg-line-green text-white p-3 rounded-xl shadow-sm text-sm leading-relaxed break-words bubble-right relative">
                        ${text}
                    </div>
                    <div class="flex items-center gap-1 mt-1 mr-1">
                        <span class="text-[10px] text-gray-500">Read</span>
                        <span class="text-[10px] text-gray-500">${getCurrentTime()}</span>
                    </div>
                </div>
            `;
            chatBox.appendChild(msgContainer);
            scrollToBottom();
        }

        // --- 3. Game Logic ---

        async function initGame() {
            // Initial Date Stamp
            const dateDiv = document.createElement('div');
            dateDiv.className = 'text-center my-4';
            dateDiv.innerHTML = '<span class="bg-black/20 text-white text-xs py-1 px-3 rounded-full backdrop-blur-sm shadow-sm">Today</span>';
            chatBox.appendChild(dateDiv);

            // Intro Sequence with specific image position
            await botReply(gameData.intro.part1);
            await botReply(gameData.intro.image, 'image');
            await botReply(gameData.intro.part2);
        }

        async function handleLogic(input) {
            const text = input.trim().toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]/g, ''); // Allow Chinese chars
            
            if (gameState.isProcessing) return;

            // 0. START
            if (gameState.step === 0) {
                if (text.includes('start') || text.includes('é–‹å§‹')) {
                    gameState.step = 1;
                    await botReply(gameData.level1.text);
                    await botReply(gameData.level1.image, 'image');
                    await botReply("Input the number (e.g., 500):");
                } else {
                    await botReply("Agent, type **Start** to open the case.\næ¢å“¡ï¼Œè«‹è¼¸å…¥ **Start** é–‹å•Ÿæ¡ˆä»¶ã€‚");
                }
                return;
            }

            // 1. DATA FILE (Q1) -> Answer: 1 Million
            if (gameState.step === 1) {
                if (text.includes('1000000') || text.includes('1m') || text.includes('one') || text.includes('100') || text.includes('ç™¾è¬')) {
                    gameState.step = 2;
                    await botReply("âœ… **Data Recovered.**\nCorrect. Nearly 1 Million people.\næ­£ç¢ºï¼Œå°‡è¿‘ä¸€ç™¾è¬äººã€‚");
                    await botReply("----------------");
                    await botReply(gameData.level2.text);
                    await botReply(gameData.level2.video, 'video');
                    await botReply(gameData.level2.image, 'image');
                } else if (text.includes('hint') || text.includes('æç¤º')) {
                    await botReply("ğŸ’¡ Hint: Look at the last bar on the graph.\næç¤ºï¼šçœ‹åœ–è¡¨ä¸Šæœ€å¾Œä¸€æ ¹é•·æ¢çš„é«˜åº¦ã€‚");
                } else {
                    await botReply("âŒ Analysis Failed. Check the chart again.\nåˆ†æå¤±æ•—ï¼Œè«‹é‡æ–°æª¢æŸ¥åœ–è¡¨ã€‚");
                }
                return;
            }

            // 2. SCENE INVESTIGATION (Q2) -> Answer: Pit Latrine
            if (gameState.step === 2) {
                if (text.includes('pit') || text.includes('latrine') || text.includes('toilet') || text.includes('æ—±å»') || text.includes('b')) {
                    gameState.step = 3;
                    await botReply("âœ… **Hazard Identified.**\nPit Latrine (æ—±å»). A tragedy caused by neglect.\né€™æ˜¯å› å¿½è¦–è€Œé€ æˆçš„æ‚²åŠ‡ã€‚");
                    await botReply("----------------");
                    await botReply(gameData.level3.text);
                    await botReply(gameData.level3.image, 'image');
                } else if (text.includes('hint') || text.includes('æç¤º')) {
                    await botReply("ğŸ’¡ Hint: Item B looks dangerous.\næç¤ºï¼šç‰©å“ B çœ‹èµ·ä¾†å¾ˆå±éšªã€‚");
                } else {
                    await botReply("âŒ Negative. Look for the 'Pit Latrine'.\nä¸å°ï¼Œè«‹å°‹æ‰¾ã€Œæ—±å»ã€ã€‚");
                }
                return;
            }

            // 3. LOGIC TEST (Q3) -> Answer: B
            if (gameState.step === 3) {
                if (text === 'b' || text.includes('everyone')) {
                    gameState.step = 4;
                    await botReply("âœ… **Verified.**\nRights belong to everyone.\näººæ¬Šå±¬æ–¼æ¯ä¸€å€‹äººã€‚");
                    // Insert verified image here
                    await botReply(gameData.level3.successImage, 'image');
                    await botReply("----------------");
                    await botReply(gameData.level4.text);
                    await botReply(gameData.level4.image, 'image');
                } else {
                    await botReply("âŒ Logic Error. Review the Universal Declaration.\né‚è¼¯éŒ¯èª¤ã€‚è«‹å›é¡§ä¸–ç•Œäººæ¬Šå®£è¨€ã€‚");
                }
                return;
            }

            // 4. EVIDENCE BOARD (Q4) -> Answer: JUAN
            if (gameState.step === 4) {
                if (text.includes('juan')) {
                    gameState.step = 5;
                    await botReply("âœ… **Identity Confirmed: Juan LÃ³pez.**\nHe fought for the river.\nä»–ç‚ºäº†å®ˆè­·æ²³æµè€Œæˆ°ã€‚");
                    // Insert Juan's video here
                    await botReply(gameData.level4.successVideo, 'video');
                    await botReply("----------------");
                    await botReply(gameData.level5.text);
                    await botReply(gameData.level5.video, 'video');
                } else if (text.includes('hint') || text.includes('æç¤º')) {
                    await botReply("ğŸ’¡ Hint: J _ _ _.\næç¤ºï¼šJ é–‹é ­çš„åå­—ã€‚");
                } else {
                    await botReply("âŒ Unknown Subject. Look at the name tag.\nå°è±¡ä¸æ˜ã€‚çœ‹çœ‹åç‰Œã€‚");
                }
                return;
            }

            // 5. SONIA DAHMANI CASE (Q5) -> Answer: FALSE NEWS
            if (gameState.step === 5) {
                // æª¢æŸ¥é—œéµå­—ï¼šfalse news, fake news, å‡æ–°è, è¬ è¨€, æ•£æ’­
                if (text.includes('false') || text.includes('fake') || text.includes('news') || text.includes('å‡æ–°è') || text.includes('è¬ è¨€') || text.includes('æ•£æ’­')) {
                    gameState.step = 6;
                    await botReply(gameData.end.badge, 'image');
                    await botReply({
                        text: gameData.end.text,
                        link: gameData.end.link,
                        btnText: "âœï¸ Write for Rights / å¯«ä¿¡è²æ´"
                    }, 'button');
                    // Final Video
                    await botReply(gameData.end.finalVideo, 'video');
                } else if (text.includes('hint') || text.includes('æç¤º')) {
                    await botReply("ğŸ’¡ Hint: It involves speaking untruths online or in media.\næç¤ºï¼šé€™æ¶‰åŠåœ¨åª’é«”ä¸Šæ•£å¸ƒä¸å¯¦è¨Šæ¯ã€‚");
                } else {
                    await botReply("âŒ Incorrect Charge. Check the case file again.\nç½ªåä¸ç¬¦ã€‚è«‹å†æ¬¡æª¢æŸ¥æ¡ˆä»¶æª”æ¡ˆã€‚");
                }
                return;
            }

            // END
            if (gameState.step === 6) {
                await botReply("Case Closed. Thank you for your service. ğŸ•¯ï¸\næ¡ˆä»¶å·²çµæ¡ˆã€‚æ„Ÿè¬ä½ çš„æœå‹™ã€‚");
            }
        }

        // --- 4. Event Listeners ---
        function send() {
            const val = userInput.value;
            if(!val.trim()) return;
            
            userReply(val);
            userInput.value = '';
            handleLogic(val);
        }

        sendBtn.onclick = send;
        userInput.onkeydown = (e) => { if(e.key === 'Enter') send(); };

        // Start Game
        window.onload = initGame;

    </script>
</body>
</html>